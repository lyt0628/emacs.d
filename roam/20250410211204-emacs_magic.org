:PROPERTIES:
:ID:       ad1a005d-ecf3-4f8f-9bbf-01b6e596138f
:END:
#+title: emacs/magit

* Magit 的设计原则
- 命令直接转换UI，In Magit everything is actionable.
- 渐进式的内容展示



* Magit 的键位绑定
|-------------+---------------------+--------------------------------------------+--------|
| Keymap      | Git Actions         | Note                                       | Buffer |
|-------------+---------------------+--------------------------------------------+--------|
| C-x g       | git status          | 查看 Git 仓库状态                            |        |
|             | git diff [--cached] | 1. Head 指针 和对应的 commit message         |        |
|             | git log --oneline   | 2. 最新的分支行动，Push 或者 Rebase           |        |
|             |                     | 3. 最新的 Tag                               |        |
|             |                     | 4. 文件跟踪，暂存,合并和拉取信息                |        |
|-------------+---------------------+--------------------------------------------+--------|
| TAB         |                     | Toggle折叠                                  |        |
|-------------+---------------------+--------------------------------------------+--------|
| g/G         |                     | 更新Magit数据/更新Magit UI.数据在外部更改时使用 |        |
|-------------+---------------------+--------------------------------------------+--------|
| RET         |                     | 显示点位上的更多信息                          |        |
|             |                     | Commit => 提交信息和 diff 信息                |        |
|-------------+---------------------+--------------------------------------------+--------|
| C-p/C-n     |                     | 小节移动                                     |        |
|-------------+---------------------+--------------------------------------------+--------|
| M-p/M-n     |                     | 同等级内容移动                                |        |
|-------------+---------------------+--------------------------------------------+--------|
| s           |                     | 暂存文件                                     | Status |
|-------------+---------------------+--------------------------------------------+--------|
| u           |                     | 取消文件暂存                                 |        |
|-------------+---------------------+--------------------------------------------+--------|
| d d         |                     | 仅显示Diff信息                               |        |
|-------------+---------------------+--------------------------------------------+--------|
| q           |                     | 返回上一个UI。RET 等显示新UI命令后接            |        |
|-------------+---------------------+--------------------------------------------+--------|
| d           |                     | 显示点位的diff信息, 进入Diff Buffer           | Status |
|-------------+---------------------+--------------------------------------------+--------|
| l           |                     | 显示点位的 log 信息                           |        |
|-------------+---------------------+--------------------------------------------+--------|
| d           |                     | 进入 DWIM （Do what i mean）                |        |
|-------------+---------------------+--------------------------------------------+--------|
| s           |                     | 显示diff下标                                 | Diff   |
|-------------+---------------------+--------------------------------------------+--------|
| r           |                     | 查找范围内的Diff                             | Diff   |
|-------------+---------------------+--------------------------------------------+--------|
| c           |                     | 进入Commit Buff                             | Status |
|-------------+---------------------+--------------------------------------------+--------|
| c           |                     | 创建提交                                     | Commit |
|-------------+---------------------+--------------------------------------------+--------|
| P           |                     | 进入 Push BUff(Buffer切换的键位都是大写)       | Status |
|-------------+---------------------+--------------------------------------------+--------|
| p           |                     | 推送当前分支                                 | Push   |
|-------------+---------------------+--------------------------------------------+--------|
| F           |                     | 进入 Fetch Buff                             |        |
|-------------+---------------------+--------------------------------------------+--------|
| b c         |                     | 创建分支                                     |        |
|-------------+---------------------+--------------------------------------------+--------|
| b b         |                     | 切换分支                                     |        |
|-------------+---------------------+--------------------------------------------+--------|
| m m         |                     | 合并分支                                     |        |
|-------------+---------------------+--------------------------------------------+--------|
| r           |                     | 进入 Rebase Buff                            |        |
|-------------+---------------------+--------------------------------------------+--------|
| i           |                     | 交互式变基                                   | Rebase |
|-------------+---------------------+--------------------------------------------+--------|
| z s         | git add             | 暂存修改                                     |        |
|-------------+---------------------+--------------------------------------------+--------|
| z a         |                     | 恢复暂存                                     |        |
|-------------+---------------------+--------------------------------------------+--------|
| l l         |                     | 显示提交日志                                 |        |
|-------------+---------------------+--------------------------------------------+--------|
| ?           |                     | 查看所有键位                                 | Status |
|-------------+---------------------+--------------------------------------------+--------|
| h           |                     | 显示上下文帮助                                |        |
|-------------+---------------------+--------------------------------------------+--------|
| M           |                     | 进入 Remote Buff                            | Status |
|-------------+---------------------+--------------------------------------------+--------|
| l           |                     | 列出所有远程仓库                              | Remote |
|-------------+---------------------+--------------------------------------------+--------|
| a           |                     | 添加远程仓库                                 | Remote |
|-------------+---------------------+--------------------------------------------+--------|
| magic-clone |                     | 克隆仓库                                     |        |
|-------------+---------------------+--------------------------------------------+--------|
PS: TODO: 支持 Evil 绑定 


* Common Workflow
** Branch-Merge
#+begin_src dot :file ./.emacs-magit-workflow-branch-merge.png
  digraph G
  {
      bgcolor="#0000FF44:#FF000044";

      subgraph cluster_main{
          node[] a0;
          node[] a1;
          node[] a2;

          a0 -> a1[style="dotted"];
          a1 -> a2[label="continue develop"];
          a2 -> "..."
      }

      subgraph cluster_feat{
          node[] b0;
          node[] b1;

          b0 -> b1;
      }

      a0 -> b0 [style="dashed", label="Create new branch"];
      b1 -> a1 [style="dashed", label="merge the modified"];
  }
#+end_src

#+RESULTS:
[[file:./.emacs-magit-workflow-branch-merge.png]]



